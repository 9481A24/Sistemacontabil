<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contabilidade por Cliente</title>
<style>
html,body{margin:0;padding:0;width:100%;height:100%;font-family:Arial;background:#f2f2f2}
.container{padding:12px}
.card{background:#fff;border-radius:8px;padding:10px;margin-bottom:12px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
input,select,button{width:100%;padding:8px;margin-top:6px}
button{background:#111;color:#fff;border:none;border-radius:6px}
button.red{background:#c62828}
button.gray{background:#555}
.cliente{padding:6px;border-bottom:1px solid #eee;cursor:pointer}
.entrada{color:green}
.saida{color:red}
small{color:#555}
#relatorioPrint{display:none}
@media print{
  body *{display:none}
  #relatorioPrint{display:block}
}
</style>
</head>
<body>
<div class="container">

<h2>游늵 Contabilidade por Cliente</h2>

<div class="card">
<h3>游녻 Cliente</h3>
<input id="nomeCliente" placeholder="Nome do cliente">
<button onclick="addCliente()">Salvar Cliente</button>
</div>

<div class="card">
<h3>游늶 Clientes</h3>
<div id="listaClientes"></div>
</div>

<div class="card">
<h3>游눺 Cliente Selecionado:</h3>
<p style="font-size:18px;font-weight:bold;color:#111" id="clienteAtual">Nenhum</p>
<p>Saldo: R$ <span id="saldoCliente">0</span></p>
<input id="valor" type="number" placeholder="Valor">
<input id="desc" placeholder="Descri칞칚o">
<input id="nota" placeholder="Nota / Observa칞칚o">
<select id="tipo">
<option value="entrada">Entrada</option>
<option value="saida">Sa칤da</option>
</select>
<!-- Input de data para lan칞ar na data escolhida -->
<input id="dataEscolhida" type="date" placeholder="Escolha dia/m칡s/ano">
<button onclick="lancar()">Lan칞ar</button>
<button class="gray" onclick="imprimirMes()">Imprimir Relat칩rio</button>
<button class="red" onclick="deletarCliente()">Deletar Cliente</button>
</div>

<div class="card">
<h3>游닆 Hist칩rico</h3>
<div id="historico"></div>
</div>
</div>

<!-- RELAT칍RIO -->
<div id="relatorioPrint">
<h2>Relat칩rio</h2>
<p><b>Cliente:</b> <span id="clientePrint"></span></p>
<p><b>Data:</b> <span id="mesPrint"></span></p>
<hr>
<div id="historicoPrint"></div>
</div>

<script>
let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
let lancamentos = JSON.parse(localStorage.getItem('lancamentos')) || [];
let clienteSelecionado = null;

function salvar(){
  localStorage.setItem('clientes', JSON.stringify(clientes));
  localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
}

function addCliente(){
  const input = document.getElementById('nomeCliente');
  const nome = input.value.trim();
  if(!nome){ alert('Digite o nome do cliente'); return; }

  clientes.push({ id: Date.now(), nome });
  input.value = '';
  salvar();
  listarClientes();
}

function listarClientes(){
  const lista = document.getElementById('listaClientes');
  lista.innerHTML = '';

  clientes.forEach(c => {
    const d = document.createElement('div');
    d.className = 'cliente';
    d.textContent = c.nome;
    d.onclick = () => selecionarCliente(c);
    lista.appendChild(d);
  });
}

function selecionarCliente(c){
  clienteSelecionado = c;
  document.getElementById('clienteAtual').innerText = c.nome;
  atualizar();
}

function lancar(){
  if(!clienteSelecionado){ alert('Selecione um cliente'); return; }

  const valorEl = document.getElementById('valor');
  const descEl  = document.getElementById('desc');
  const notaEl  = document.getElementById('nota');
  const tipoEl  = document.getElementById('tipo');
  const dataEl  = document.getElementById('dataEscolhida');

  const valor = Number(valorEl.value);
  if(valor <= 0){ alert('Informe um valor v치lido'); return; }

  // Salva o lan칞amento na data escolhida ou hoje se n칚o escolher
  const dataAtual = dataEl.value ? dataEl.value : new Date().toISOString().split('T')[0];

  lancamentos.push({
    clienteId: clienteSelecionado.id,
    valor: valor,
    desc: descEl.value,
    nota: notaEl.value,
    tipo: tipoEl.value,
    data: dataAtual
  });

  valorEl.value = '';
  descEl.value = '';
  notaEl.value = '';
  dataEl.value = ''; // limpa input

  salvar();
  atualizar();
}

function atualizar(){
  const hist = document.getElementById('historico');
  hist.innerHTML = '';

  let entradas = 0;
  let saidas = 0;

  lancamentos
    .filter(l => l.clienteId === clienteSelecionado.id)
    .forEach(l => {
      if(l.tipo === 'entrada') entradas += l.valor;
      else saidas += l.valor;

      // Formata data para dd/mm/yyyy
      const [ano, mes, dia] = l.data.split('-');
      const dataFormatada = `${dia}/${mes}/${ano}`;

      hist.innerHTML += `
        <div class="${l.tipo}">
          ${l.tipo === 'entrada' ? '+' : '-'} R$ ${l.valor.toFixed(2)} - ${l.desc}
          <br><small>${l.nota} | ${dataFormatada}</small>
        </div>`;
    });

  document.getElementById('saldoCliente').innerText = (entradas - saidas).toFixed(2);
}

function deletarCliente(){
  if(!clienteSelecionado) return;
  if(!confirm('Excluir cliente e todos os lan칞amentos?')) return;

  clientes = clientes.filter(c => c.id !== clienteSelecionado.id);
  lancamentos = lancamentos.filter(l => l.clienteId !== clienteSelecionado.id);

  clienteSelecionado = null;
  document.getElementById('clienteAtual').innerText = 'Nenhum';
  document.getElementById('historico').innerHTML = '';
  document.getElementById('saldoCliente').innerText = '0';

  salvar();
  listarClientes();
}

function imprimirMes(){
  if(!clienteSelecionado){ alert('Selecione um cliente'); return; }

  const inputData = document.getElementById('dataEscolhida').value;
  let dataFiltro = inputData ? inputData : new Date().toISOString().split('T')[0];

  // Formata para exibir no relat칩rio
  const [ano, mes, dia] = dataFiltro.split('-');
  const dataFormatada = `${dia}/${mes}/${ano}`;

  document.getElementById('clientePrint').innerText = clienteSelecionado.nome;
  document.getElementById('mesPrint').innerText = dataFormatada;

  const histPrint = document.getElementById('historicoPrint');
  histPrint.innerHTML = '';

  // Filtra lan칞amentos pelo mesmo formato yyyy-mm-dd
  lancamentos
    .filter(l => l.clienteId === clienteSelecionado.id && l.data === dataFiltro)
    .forEach(l => {
      histPrint.innerHTML += `
        <div>
          ${l.tipo === 'entrada' ? '+' : '-'} R$ ${l.valor.toFixed(2)} - ${l.desc}
          <br><small>${l.nota} | ${dataFormatada}</small>
        </div>`;
    });

  window.print();
}

listarClientes();
</script>
</body>
</html>
