<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contabilidade desde 2019</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
h1,h2 { margin-top: 20px; }
input, select, button { padding: 6px; margin: 4px 0; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
table, th, td { border: 1px solid #333; }
th, td { padding: 8px; text-align: center; }
th { background: #555; color: #fff; }
tr.entrada { background: #d4f8d4; }
tr.saida { background: #f8d4d4; }

/* Menu de abas */
.tabs { display: flex; margin-bottom: 10px; }
.tab { padding: 10px 20px; cursor: pointer; background: #ddd; margin-right: 2px; border-radius: 5px 5px 0 0; }
.tab.active { background: #555; color: #fff; }
.tabContent { display: none; padding: 10px; background: #fff; border-radius: 0 5px 5px 5px; }

/* Lista de clientes vertical */
#listaClientes button { display: block; width: 100%; margin: 3px 0; padding: 6px; text-align: left; }

@media print {
  body { background: #fff; }
  .tabs, input, select, button { display: none; }
  table { page-break-inside: auto; }
  tr { page-break-inside: avoid; page-break-after: auto; }
}
</style>
</head>
<body>

<h1>Contabilidade desde 2019</h1>

<!-- Menu de abas -->
<div class="tabs">
  <div class="tab active" onclick="abrirAba('cadastro')">Cadastro Cliente</div>
  <div class="tab" onclick="abrirAba('lista')">Lista de Clientes</div>
  <div class="tab" onclick="abrirAba('movimentacoes')">Movimentações / Relatório</div>
</div>

<!-- Aba Cadastro -->
<div id="cadastro" class="tabContent" style="display:block;">
  <h2>Cadastro de Cliente</h2>
  <input type="text" id="clienteNome" placeholder="Nome do cliente" onblur="preencherInteligente()"><br>
  <input type="text" id="clienteCpfCnpj" placeholder="CPF / CNPJ"><br>
  <input type="text" id="clienteEndereco" placeholder="Endereço"><br>
  <input type="text" id="clienteTelefone" placeholder="Telefone"><br>
  <button onclick="adicionarCliente()">Adicionar Cliente</button>
</div>

<!-- Aba Lista -->
<div id="lista" class="tabContent">
  <h2>Lista de Clientes</h2>
  <div id="listaClientes"></div>
  <button onclick="excluirCliente()">Excluir Cliente Selecionado</button>
</div>

<!-- Aba Movimentações -->
<div id="movimentacoes" class="tabContent">
  <h2>Lançamento de Movimentação</h2>
  <select id="clientesSelect"></select><br>
  <label>Data: <input type="date" id="movData"></label><br>
  <label>Descrição: <input type="text" id="movDescricao"></label><br>
  <label>Tipo:
    <select id="movTipo">
      <option value="entrada">Entrada</option>
      <option value="saida">Saída</option>
    </select>
  </label><br>
  <label>Valor: <input type="number" id="movValor"></label><br>
  <button onclick="adicionarMovimentacao()">Adicionar Movimentação</button>

  <h2>Movimentações do Cliente</h2>
  <div id="relatorioCliente">
    <h3 id="relClienteNome"></h3>
    <h4 id="relPeriodo"></h4>
    <table id="relatorioTable">
      <thead>
        <tr>
          <th>Data</th>
          <th>Descrição</th>
          <th>Entrada (R$)</th>
          <th>Saída (R$)</th>
          <th>Saldo (R$)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h4 id="resumoFinal"></h4>
  </div>

  <button onclick="imprimirRelatorio()">Imprimir / PDF</button>
  <button onclick="enviarWhatsApp()">Enviar WhatsApp</button>
</div>

<script>
let clientes = [];
let movimentacoes = {};
let clienteSelecionado = null;

// Funções de abas
function abrirAba(aba) {
  document.querySelectorAll('.tabContent').forEach(div => div.style.display='none');
  document.getElementById(aba).style.display='block';
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.tab[onclick="abrirAba('${aba}')"]`).classList.add('active');
}

// Adicionar cliente
function adicionarCliente() {
  const nome = document.getElementById('clienteNome').value.trim();
  const cpfCnpj = document.getElementById('clienteCpfCnpj').value.trim();
  const endereco = document.getElementById('clienteEndereco').value.trim();
  const telefone = document.getElementById('clienteTelefone').value.trim();
  
  if(!nome || !cpfCnpj || !endereco || !telefone) return alert('Preencha todos os campos!');
  
  if(!clientes.some(c=>c.nome===nome && c.cpfCnpj===cpfCnpj)) {
    const clienteObj = { nome, cpfCnpj, endereco, telefone };
    clientes.push(clienteObj);
    movimentacoes[nome] = [];
    atualizarSelects();
    atualizarListaClientes();
    document.getElementById('clienteNome').value='';
    document.getElementById('clienteCpfCnpj').value='';
    document.getElementById('clienteEndereco').value='';
    document.getElementById('clienteTelefone').value='';
  } else {
    alert('Cliente já existe!');
  }
}

// Preenchimento inteligente
function preencherInteligente() {
  const nome = document.getElementById('clienteNome').value.trim();
  if(!nome) return;

  // CPF aleatório válido
  const cpf = gerarCPF();
  document.getElementById('clienteCpfCnpj').value = cpf;

  // Telefone rápido
  const tel = "31" + Math.floor(900000000 + Math.random()*99999999);
  document.getElementById('clienteTelefone').value = tel;

  // Endereço padrão
  document.getElementById('clienteEndereco').value = "Rua Exemplo, Bairro Teste, Belo Horizonte";
}

// Gerar CPF válido simples
function gerarCPF() {
  let n = [];
  for(let i=0;i<9;i++) n[i]=Math.floor(Math.random()*9);
  
  let d1 = n.reduce((acc,num,i)=>acc + num*(10-i),0);
  d1 = 11 - (d1 % 11); if(d1>=10)d1=0;

  let d2 = n.reduce((acc,num,i)=>acc + num*(11-i),0) + d1*2;
  d2 = 11 - (d2 % 11); if(d2>=10)d2=0;

  return n.join('') + d1 + d2;
}

// Atualizar selects
function atualizarSelects() {
  const clientesSelect = document.getElementById('clientesSelect');
  clientesSelect.innerHTML='';
  clientes.forEach(c=>{
    const option = document.createElement('option');
    option.value = c.nome;
    option.textContent = c.nome;
    clientesSelect.appendChild(option);
  });
}

// Atualizar lista clientes vertical com seleção
function atualizarListaClientes() {
  const lista = document.getElementById('listaClientes');
  lista.innerHTML='';
  clientes.forEach(c=>{
    const btn = document.createElement('button');
    btn.textContent = c.nome;
    
    btn.onclick = ()=>{
      document.querySelectorAll('#listaClientes button').forEach(b => b.style.background = '');
      clienteSelecionado = c.nome;
      btn.style.background = '#a0c4ff';
      mostrarMovimentacoes(c.nome);
      abrirAba('movimentacoes');
    };
    lista.appendChild(btn);
  });
}

// Adicionar movimentação
function adicionarMovimentacao() {
  const cliente = document.getElementById('clientesSelect').value;
  if(!cliente) return alert('Selecione um cliente!');
  const data = document.getElementById('movData').value;
  const descricao = document.getElementById('movDescricao').value.trim();
  const tipo = document.getElementById('movTipo').value;
  const valor = parseFloat(document.getElementById('movValor').value);
  if(!data || !descricao || !valor) return alert('Preencha todos os campos!');

  movimentacoes[cliente].push({ data, descricao, tipo, valor });
  if(clienteSelecionado === cliente) mostrarMovimentacoes(cliente);

  document.getElementById('movData').value='';
  document.getElementById('movDescricao').value='';
  document.getElementById('movValor').value='';
}

// Mostrar movimentações
function mostrarMovimentacoes(cliente) {
  const tbody = document.querySelector('#relatorioTable tbody');
  tbody.innerHTML='';
  let saldo=0, totalEntrada=0, totalSaida=0;
  clienteSelecionado=cliente;
  document.getElementById('relClienteNome').textContent="Cliente: "+cliente;
  const movimentos = movimentacoes[cliente].sort((a,b)=>new Date(a.data)-new Date(b.data));
  let dataInicio=movimentos.length?movimentos[0].data:'';
  let dataFim=movimentos.length?movimentos[movimentos.length-1].data:'';
  document.getElementById('relPeriodo').textContent="Período: "+dataInicio+" até "+dataFim;

  movimentos.forEach(mov=>{
    saldo+=(mov.tipo==='entrada'?mov.valor:-mov.valor);
    if(mov.tipo==='entrada') totalEntrada+=mov.valor;
    if(mov.tipo==='saida') totalSaida+=mov.valor;
    const tr=document.createElement('tr');
    tr.className=mov.tipo;
    tr.innerHTML=`<td>${mov.data}</td>
                  <td>${mov.descricao}</td>
                  <td>${mov.tipo==='entrada'?mov.valor.toFixed(2):''}</td>
                  <td>${mov.tipo==='saida'?mov.valor.toFixed(2):''}</td>
                  <td>${saldo.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('resumoFinal').textContent=`Total Entrada: R$${totalEntrada.toFixed(2)} | Total Saída: R$${totalSaida.toFixed(2)} | Saldo Final: R$${saldo.toFixed(2)}`;
}

// Excluir cliente
function excluirCliente() {
  if(!clienteSelecionado) return alert('Selecione um cliente para excluir!');
  const confirma = confirm(`Deseja excluir "${clienteSelecionado}" e todas as movimentações?`);
  if(!confirma) return;
  
  delete movimentacoes[clienteSelecionado];
  clientes = clientes.filter(c => c.nome !== clienteSelecionado);
  clienteSelecionado = null;
  
  atualizarSelects();
  atualizarListaClientes();
  
  document.querySelector('#relatorioTable tbody').innerHTML='';
  document.getElementById('relClienteNome').textContent='';
  document.getElementById('relPeriodo').textContent='';
  document.getElementById('resumoFinal').textContent='';
}

// Imprimir / PDF
function imprimirRelatorio() {
  if(!clienteSelecionado) return alert('Selecione um cliente!');
  window.print();
}

// WhatsApp
function enviarWhatsApp() {
  if(!clienteSelecionado) return alert('Selecione um cliente!');
  let mensagem=`Relatório do cliente: ${clienteSelecionado}\n\n`;
  movimentacoes[clienteSelecionado].forEach(mov=>{
    mensagem+=`${mov.data} - ${mov.descricao} - ${mov.tipo==='entrada'?'+':'-'}${mov.valor.toFixed(2)}\n`;
  });
  const url=`https://api.whatsapp.com/send?text=${encodeURIComponent(mensagem)}`;
  window.open(url,'_blank');
}
</script>

</body>
</html>
