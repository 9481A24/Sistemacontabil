
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contabilidade desde 2019</title>

<style>
body { font-family: Arial, sans-serif; background: #f2f2f2; padding: 20px; }
h1,h2 { margin-top: 20px; }
input, select, button { padding: 6px; margin: 4px 0; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
table, th, td { border: 1px solid #333; }
th, td { padding: 8px; text-align: center; }
th { background: #555; color: #fff; }
tr.entrada { background: #d4f8d4; }
tr.saida { background: #f8d4d4; }

.tabs { display: flex; margin-bottom: 10px; }
.tab { padding: 10px 20px; cursor: pointer; background: #ddd; margin-right: 2px; border-radius: 5px 5px 0 0; }
.tab.active { background: #555; color: #fff; }
.tabContent { display: none; padding: 10px; background: #fff; border-radius: 0 5px 5px 5px; }

.linhaCliente {
  display: flex;
  gap: 6px;
  margin-bottom: 5px;
}
.linhaCliente button:first-child {
  flex: 1;
  text-align: left;
}
.btnExcluir {
  background: #c62828;
  color: #fff;
}
@media print {
  .tabs, input, select, button { display: none; }
}
</style>
</head>

<body>

<h1>Contabilidade desde 2019</h1>

<div class="tabs">
  <div class="tab active" onclick="abrirAba('cadastro')">Cadastro Cliente</div>
  <div class="tab" onclick="abrirAba('lista')">Lista de Clientes</div>
  <div class="tab" onclick="abrirAba('movimentacoes')">Movimentações</div>
</div>

<!-- CADASTRO -->
<div id="cadastro" class="tabContent" style="display:block;">
  <h2>Cadastro de Cliente</h2>
  <input id="clienteNome" placeholder="Nome"><br>
  <input id="clienteCpfCnpj" placeholder="CPF / CNPJ"><br>
  <input id="clienteEndereco" placeholder="Endereço"><br>
  <input id="clienteTelefone" placeholder="Telefone"><br>
  <button onclick="adicionarCliente()">Adicionar Cliente</button>
</div>

<!-- LISTA -->
<div id="lista" class="tabContent">
  <h2>Lista de Clientes</h2>
  <div id="listaClientes"></div>
</div>

<!-- MOVIMENTAÇÕES -->
<div id="movimentacoes" class="tabContent">
  <h2>Lançamento</h2>
  <select id="clientesSelect"></select><br>
  <input type="date" id="movData"><br>
  <input id="movDescricao" placeholder="Descrição"><br>
  <select id="movTipo">
    <option value="entrada">Entrada</option>
    <option value="saida">Saída</option>
  </select><br>
  <input type="number" id="movValor" placeholder="Valor"><br>
  <button onclick="adicionarMovimentacao()">Adicionar</button>

  <h2>Relatório</h2>
  <h3 id="relClienteNome"></h3>
  <h4 id="relPeriodo"></h4>

  <table id="relatorioTable">
    <thead>
      <tr>
        <th>Data</th>
        <th>Descrição</th>
        <th>Entrada</th>
        <th>Saída</th>
        <th>Saldo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h4 id="resumoFinal"></h4>

  <button onclick="imprimirRelatorio()">Imprimir</button>
  <button onclick="enviarWhatsApp()">WhatsApp</button>
</div>

<script>
// ================= CARREGAMENTO =================
let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
let movimentacoes = JSON.parse(localStorage.getItem('movimentacoes')) || {};
let clienteSelecionado = null;

function salvarDados(){
  localStorage.setItem('clientes', JSON.stringify(clientes));
  localStorage.setItem('movimentacoes', JSON.stringify(movimentacoes));
}
window.addEventListener("beforeunload", salvarDados);

// ================= ABAS =================
function abrirAba(id){
  document.querySelectorAll('.tabContent').forEach(d=>d.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  event.target.classList.add('active');
}

// ================= CLIENTES =================
function adicionarCliente(){
  const nome = clienteNome.value.trim();
  if(!nome) return alert("Informe o nome");

  if(clientes.some(c=>c.nome===nome)){
    alert("Cliente já existe");
    return;
  }

  clientes.push({
    nome,
    cpfCnpj: clienteCpfCnpj.value,
    endereco: clienteEndereco.value,
    telefone: clienteTelefone.value
  });

  movimentacoes[nome] = [];
  salvarDados();
  atualizarTudo();

  clienteNome.value = clienteCpfCnpj.value =
  clienteEndereco.value = clienteTelefone.value = '';
}

function atualizarTudo(){
  clientesSelect.innerHTML = '';
  listaClientes.innerHTML = '';

  clientes.forEach(c=>{
    // select
    const op = document.createElement('option');
    op.value = c.nome;
    op.textContent = c.nome;
    clientesSelect.appendChild(op);

    // linha
    const linha = document.createElement('div');
    linha.className = 'linhaCliente';

    // botão nome
    const btnNome = document.createElement('button');
    btnNome.textContent = c.nome;
    btnNome.onclick = ()=>{
      clienteSelecionado = c.nome;
      mostrarMovimentacoes(c.nome);
      abrirAba('movimentacoes');
    };

    // botão excluir
    const btnExcluir = document.createElement('button');
    btnExcluir.textContent = 'Excluir';
    btnExcluir.className = 'btnExcluir';
    btnExcluir.onclick = ()=>{
      if(confirm(`Excluir o cliente "${c.nome}"?`)){
        clientes = clientes.filter(cli=>cli.nome!==c.nome);
        delete movimentacoes[c.nome];
        salvarDados();
        atualizarTudo();
      }
    };

    linha.appendChild(btnNome);
    linha.appendChild(btnExcluir);
    listaClientes.appendChild(linha);
  });
}

// ================= MOVIMENTAÇÕES =================
function adicionarMovimentacao(){
  const c = clientesSelect.value;
  if(!c) return;

  if(!movimentacoes[c]) movimentacoes[c] = [];

  movimentacoes[c].push({
    data: movData.value,
    descricao: movDescricao.value,
    tipo: movTipo.value,
    valor: Number(movValor.value)
  });

  salvarDados();
  mostrarMovimentacoes(c);

  movData.value = movDescricao.value = movValor.value = '';
}

function mostrarMovimentacoes(c){
  const tbody = relatorioTable.querySelector('tbody');
  tbody.innerHTML = '';
  let saldo = 0, e = 0, s = 0;

  relClienteNome.textContent = "Cliente: " + c;

  [...movimentacoes[c]].sort((a,b)=>new Date(a.data)-new Date(b.data))
  .forEach(m=>{
    saldo += m.tipo==='entrada'?m.valor:-m.valor;
    m.tipo==='entrada'?e+=m.valor:s+=m.valor;

    tbody.innerHTML += `
      <tr class="${m.tipo}">
        <td>${m.data}</td>
        <td>${m.descricao}</td>
        <td>${m.tipo==='entrada'?m.valor.toFixed(2):''}</td>
        <td>${m.tipo==='saida'?m.valor.toFixed(2):''}</td>
        <td>${saldo.toFixed(2)}</td>
      </tr>`;
  });

  resumoFinal.textContent =
    `Entrada R$${e.toFixed(2)} | Saída R$${s.toFixed(2)} | Saldo R$${saldo.toFixed(2)}`;
}

// ================= OUTROS =================
function imprimirRelatorio(){ window.print(); }

function enviarWhatsApp(){
  if(!clienteSelecionado) return;
  let msg = `Relatório ${clienteSelecionado}\n`;
  movimentacoes[clienteSelecionado].forEach(m=>{
    msg += `${m.data} ${m.descricao} ${m.tipo==='entrada'?'+':'-'}${m.valor}\n`;
  });
  window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`);
}

// ================= INIT =================
window.onload = atualizarTudo;
</script>

</body>
</html>
